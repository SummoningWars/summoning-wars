<!-- second switch trader -->
<NPC refname = "Eric">
</NPC>

<!-- traders -->
<NPC refname="Haffgar">
	<Trade refresh_time="600000" price_factor="1.5">
		<TradeItem subtype="legion_sw"  number="1" number_magical="0"/>
		<TradeItem subtype="long_sw"  number="1" number_magical="0"/>
		<TradeItem subtype="horse_sw"  number="1" number_magical="0"/>
		<TradeItem subtype="bast_sw"  number="1" number_magical="0"/>
		<TradeItem subtype="mrnstr_hmr"  number="1" number_magical="0"/>
		<TradeItem subtype="crow_hmr"  number="1" number_magical="0"/>
		<TradeItem subtype="silver_hmr"  number="1" number_magical="0"/>
		<TradeItem subtype="glow_hmr"  number="1" number_magical="0"/>
		<TradeItem subtype="rattan_sbw"  number="1" number_magical="0"/>
		<TradeItem subtype="bandit_sbw"  number="1" number_magical="0"/>
		<TradeItem subtype="soldr_lbw"  number="1" number_magical="0"/>
		<TradeItem subtype="horn_lbw"  number="1" number_magical="0"/>
		<TradeItem subtype="iron_axe"  number="1" number_magical="0"/>
		<TradeItem subtype="merc_axe"  number="1" number_magical="0"/>
		<TradeItem subtype="smash_axe"  number="1" number_magical="0"/>
		<TradeItem subtype="ogrhac_axe"  number="1" number_magical="0"/>
		<TradeItem subtype="alder_wnd_fire"  number="1" number_magical="0"/>
		<TradeItem subtype="magus_wnd_fire"  number="1" number_magical="0"/>
		<TradeItem subtype="alder_wnd_air"  number="1" number_magical="0"/>
		<TradeItem subtype="magus_wnd_air"  number="1" number_magical="0"/>
		<TradeItem subtype="alder_wnd_ice"  number="1" number_magical="0"/>
		<TradeItem subtype="magus_wnd_ice"  number="1" number_magical="0"/>
		<TradeItem subtype="alder_stf_fire"  number="1" number_magical="0"/>
		<TradeItem subtype="magus_stf_fire"  number="1" number_magical="0"/>
		<TradeItem subtype="alder_stf_air"  number="1" number_magical="0"/>
		<TradeItem subtype="magus_stf_air"  number="1" number_magical="0"/>
		<TradeItem subtype="alder_stf_ice"  number="1" number_magical="0"/>
		<TradeItem subtype="magus_stf_ice"  number="1" number_magical="0"/>
	</Trade>

	<Topic name="trade" start_option="Trade" />
</NPC>

<NPC refname="Amelia">
	<Trade refresh_time="600000" price_factor="1.5">
		<TradeItem subtype="merc_arm"  number="1" number_magical="0"/>
		<TradeItem subtype="rngsh_arm"  number="1" number_magical="0"/>
		<TradeItem subtype="assass_arm"  number="1" number_magical="0"/>
		<TradeItem subtype="temple_arm"  number="1" number_magical="0"/>
		<TradeItem subtype="sholar_rob"  number="1" number_magical="0"/>
		<TradeItem subtype="mage_rob"  number="1" number_magical="0"/>
		<TradeItem subtype="iron_shd"  number="1" number_magical="0"/>
		<TradeItem subtype="steel_shd"  number="1" number_magical="0"/>
		<TradeItem subtype="merc_hlm"  number="1" number_magical="0"/>
		<TradeItem subtype="rngbnd_hlm"  number="1" number_magical="0"/>
		<TradeItem subtype="assass_hlm"  number="1" number_magical="0"/>
		<TradeItem subtype="spider_glv"  number="1" number_magical="0"/>
		<TradeItem subtype="marksm_glv"  number="1" number_magical="0"/>
		<TradeItem subtype="assass_glv"  number="1" number_magical="0"/>
	</Trade>	
	<Topic name="trade" start_option="Trade" />
</NPC>

<NPC refname="Drago">
	<Trade refresh_time="300000" price_factor="1.5">
		<TradeItem subtype="heal_2" number ="30" />
		<TradeItem subtype="heal_fr" number ="5" />
		<TradeItem subtype="heal_py" number ="5" />
		<TradeItem subtype="heal_bl" number ="5" />
		<TradeItem subtype="heal_ps" number ="5" />
	</Trade>
	
	<Topic name="trade" start_option="Potions" />
	
	<Topic name="start_dialogue" >
		<Effect>
			local pl = getSpeaker("main_player");
			set(pl,"health",get(pl,"max_health"));
		</Effect>
	</Topic>
</NPC>

<NPC refname="Flynn">
	<Trade refresh_time="600000" price_factor="10">
		<TradeItem subtype="legion_sw"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.6"/>
		<TradeItem subtype="long_sw"  number="0" number_magical="2" min_enchant="200" max_enchant="500" probability="0.5"/>
		<TradeItem subtype="bast_sw"  number="0" number_magical="2" min_enchant="200" max_enchant="400" probability="0.5"/>
		
		<TradeItem subtype="mrnstr_hmr"  number="0" number_magical="2" min_enchant="200" max_enchant="400" probability="0.5"/>
		<TradeItem subtype="crow_hmr"  number="0" number_magical="2" min_enchant="200" max_enchant="500" probability="0.5"/>
		<TradeItem subtype="silver_hmr"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.6"/>
		<TradeItem subtype="glow_hmr"  number="0" number_magical="2" min_enchant="200" max_enchant="500" probability="0.5"/>
		
		<TradeItem subtype="iron_axe"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.6"/>
		<TradeItem subtype="merc_axe"  number="0" number_magical="2" min_enchant="200" max_enchant="500" probability="0.5"/>
		<TradeItem subtype="smash_axe"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.6"/>
		<TradeItem subtype="ogrhac_axe"  number="0" number_magical="2" min_enchant="200" max_enchant="500" probability="0.5"/>
		
		<TradeItem subtype="rattan_sbw"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.4"/>
		<TradeItem subtype="bandit_sbw"  number="0" number_magical="3" min_enchant="200" max_enchant="500" probability="0.5"/>
		<TradeItem subtype="soldr_lbw"  number="0" number_magical="2" min_enchant="200" max_enchant="400" probability="0.6"/>
		<TradeItem subtype="horn_lbw"  number="0" number_magical="2" min_enchant="200" max_enchant="500" probability="0.6"/>
		
		<TradeItem subtype="alder_wnd_fire"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.4"/>
		<TradeItem subtype="magus_wnd_fire"  number="0" number_magical="1" min_enchant="200" max_enchant="500" probability="0.4"/>
		<TradeItem subtype="alder_wnd_air"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.4"/>
		<TradeItem subtype="magus_wnd_air"  number="0" number_magical="1" min_enchant="200" max_enchant="500" probability="0.4"/>
		<TradeItem subtype="alder_wnd_ice"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.4"/>
		<TradeItem subtype="magus_wnd_ice"  number="0" number_magical="1" min_enchant="200" max_enchant="500" probability="0.4"/>
		<TradeItem subtype="alder_stf_fire"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.4"/>
		<TradeItem subtype="alder_stf_air"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.4"/>
		<TradeItem subtype="alder_stf_ice"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.4"/>
		<TradeItem subtype="magus_stf_fire"  number="0" number_magical="1" min_enchant="200" max_enchant="500" probability="0.4"/>
		<TradeItem subtype="magus_stf_air"  number="0" number_magical="1" min_enchant="200" max_enchant="500" probability="0.4"/>
		<TradeItem subtype="magus_stf_ice"  number="0" number_magical="1" min_enchant="200" max_enchant="500" probability="0.4"/>
		
		<TradeItem subtype="merc_arm"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.6"/>
		<TradeItem subtype="rngsh_arm"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.6"/>
		<TradeItem subtype="assass_arm"  number="0" number_magical="2" min_enchant="200" max_enchant="500" probability="0.5"/>
		<TradeItem subtype="temple_arm"  number="0" number_magical="2" min_enchant="200" max_enchant="500" probability="0.5"/>
		<TradeItem subtype="sholar_rob"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.6"/>
		<TradeItem subtype="mage_rob"  number="0" number_magical="1" min_enchant="200" max_enchant="500" probability="0.5"/>
		
		<TradeItem subtype="iron_shd"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.6"/>
		<TradeItem subtype="steel_shd"  number="0" number_magical="1" min_enchant="200" max_enchant="500" probability="0.6"/>
		
		<TradeItem subtype="merc_hlm"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.6"/>
		<TradeItem subtype="rngbnd_hlm"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.6"/>
		<TradeItem subtype="assass_hlm"  number="0" number_magical="2" min_enchant="200" max_enchant="500" probability="0.5"/>
		<TradeItem subtype="birett_hlm"  number="0" number_magical="2" min_enchant="200" max_enchant="500" probability="0.5"/>
		<TradeItem subtype="beret_hat"  number="0" number_magical="1" min_enchant="200" max_enchant="400" probability="0.6"/>
		<TradeItem subtype="mage_hat"  number="0" number_magical="1" min_enchant="200" max_enchant="500" probability="0.6"/>
		
		<TradeItem subtype="spider_glv"  number="0" number_magical="1" min_enchant="200" max_enchant="500" probability="0.6"/>
		<TradeItem subtype="marksm_glv"  number="0" number_magical="1" min_enchant="200" max_enchant="500" probability="0.6"/>
		<TradeItem subtype="assass_glv"  number="0" number_magical="1" min_enchant="200" max_enchant="500" probability="0.6"/>
		
		<TradeItem subtype="silver_rng"  number="0" number_magical="5" min_enchant="100" max_enchant="400" probability="0.5"/>
		<TradeItem subtype="jet_rng"  number="0" number_magical="9" min_enchant="200" max_enchant="500" probability="0.5"/>
		<TradeItem subtype="gold_rng"  number="0" number_magical="2" min_enchant="200" max_enchant="600" probability="0.5"/>
		<TradeItem subtype="silver_aml"  number="0" number_magical="6" min_enchant="100" max_enchant="400" probability="0.5"/>
		<TradeItem subtype="coral_aml"  number="0" number_magical="8" min_enchant="200" max_enchant="500" probability="0.5"/>
		<TradeItem subtype="gold_aml"  number="0" number_magical="3" min_enchant="200" max_enchant="600" probability="0.5"/>
	</Trade>
	<Topic name="trade" start_option="Trade" />
	
	<Topic name="blackmarket" start_option="What is all this?">
		<Effect>
			speak("player",_("Quite a lot of boxes..."),"thoughtful");
			speak("Flynn",_("My predecessor left me with that chaos."),"unhappy");
			speak("Flynn",_("These are all old army supplies."),"unhappy");
			speak("Flynn",_("If you like something just point it out and I'll tell you a price."),"unhappy");
		</Effect>
	</Topic>	
</NPC>	

<NPC refname="Enchanter Fazhir">
	<Topic name="enchant_start" start_option="Enchant Items" >
		<Effect>
			-- chose a unique variable name here
			mods_dwarfenwall = {};
			
			-- List of all possible mods:
			-- max_health armor block strength dexterity willpower magic_power
			-- resist_phys resist_fire resist_ice resist_air resist_all
			-- phys_dmg fire_dmg ice_dmg air_dmg phys_mult fire_mult ice_mult air_mult attack_speed attack power

			-- options for Armor enchanting
			-- dont forget the _() markers for strings that are displayed ingame
			mods_dwarfenwall[1] = {};
			mods_dwarfenwall[1].answer_str = _("Armor")	-- string displayed in selection menu
			mods_dwarfenwall[1].itempos = "armor"		-- position of the item
			mods_dwarfenwall[1].allowed_mods = {"max_health","armor","magic_power","willpower"}
			mods_dwarfenwall[1].mod_answers = {_("Health Bonus"),_("Armor class"),_("Magic power"),_("Willpower")}
			
			mods_dwarfenwall[2] = {};
			mods_dwarfenwall[2].answer_str = _("Weapon")	-- string displayed in selection menu
			mods_dwarfenwall[2].itempos = "weapon"		-- position of the item
			if(defend_dwall.outcome=="godlike")then
				mods_dwarfenwall[2].allowed_mods = {"attack_speed", "attack", "power","fire_dmg", "ice_dmg", "air_dmg"}
				mods_dwarfenwall[2].mod_answers = {_("Attack speed"), _("Attack"), _("Power"), _("Fire damage"), _("Ice damage"), _("Air damage")}
			else
				mods_dwarfenwall[2].allowed_mods = {"attack_speed", "attack", "power","fire_dmg"}
				mods_dwarfenwall[2].mod_answers = {_("Attack speed"), _("Attack"), _("Power"), _("Fire damage")}
			end;
			
			mods_dwarfenwall[3] = {}
			mods_dwarfenwall[3].answer_str = _("Gloves")
			mods_dwarfenwall[3].itempos = "glove"		-- position of the item
			if(defend_dwall.outcome=="godlike")then
				mods_dwarfenwall[3].allowed_mods = {"dexterity", "strength", "armor", "block"}
				mods_dwarfenwall[3].mod_answers = {_("Dexterity"), _("Strength"), _("Armor"), _("Block")}
			else
				mods_dwarfenwall[3].allowed_mods = {"dexterity", "strength"}
				mods_dwarfenwall[3].mod_answers = {_("Dexterity"), _("Strength")}
			end
			
			
			-- create item Selection
			addQuestion(_("Which part of your equipment should be enchanted?"))
			local nr, mod
			for nr,mod in pairs(mods_dwarfenwall) do
				addAnswer(mod.answer_str,"select_mod");
			end;
		</Effect>
		
	</Topic>
	
	
	<Topic name="select_mod">
		<Effect>
			enchanter_mod_dwarfenwall = mods_dwarfenwall[trigger.answer_id];
			
			-- select the item as current item
			local pl = getSpeaker("main_player");
			getPlayerItem(pl,enchanter_mod_dwarfenwall.itempos);
			if (not hasCurrentItem()) then
				speak("Enchanter Fazhir",_("Hey you have no item equiped there"))
			else
				-- create modifier selection
				addQuestion(_("Which Enchantment do you want?"))
				local nr, answer
				for nr,answer in pairs(enchanter_mod_dwarfenwall.mod_answers) do
					addAnswer(answer,"check_price");
				end;
			end;
		</Effect>
	</Topic>
	
	<Topic name="check_price">
		<Effect>
			-- chose another unique variable here
			enchanter_modtype_dwarfenwall = trigger.answer_id;
			
			local pl = getSpeaker("main_player");
			local pgold = get(pl,"gold");
			
			local magic = getItemValue("magic_power");
			enchanter_price = math.ceil(800 + magic*20 + 200*math.exp( magic / 120 - 1))
			
			if (enchanter_price > pgold) then
				speak("Enchanter Fazhir",_("You dont have enough gold to pay the price of $1",{enchanter_price}))
			else
				addQuestion(_("The price is $1",{enchanter_price}))
				addAnswer("OK","do_enchant");
				addAnswer("Nah to expensive","end")
			end
		</Effect>
	</Topic>
	
	<Topic name="do_enchant">
		<Effect>
			local pl = getSpeaker("main_player");
			local pgold = get(pl,"gold");
			set(pl,"gold",pgold - enchanter_price);
			
			-- enchant strength is set here
			local mods = addItemMagicMods(enchanter_mod_dwarfenwall.allowed_mods[enchanter_modtype_dwarfenwall] ,160);
			if (mods == nil) then
				mods = 0;
			end;
			if (mods == 0) then
				speak("Enchanter Fazhir",_("It seems that this item already has such an enchantment."));
				set(pl,"gold",pgold);
			else
				--set enchant animation
				setObjectAnimation(getSpeaker("Enchanter Fazhir"), "enchant", 1500)
				-- removing the item from inventory and reinserting
				-- ensures, that the item is unequiped if level requirement is not met
				removePlayerItem(pl,enchanter_mod_dwarfenwall.itempos);
				insertPlayerItem(pl,true);
			end;
		</Effect>
	</Topic>
</NPC>
<NPC refname="Gertlinde Kampfer">
	<Trade refresh_time="300000" price_factor="1.4">
		<TradeItem subtype="heal_1" number ="30" />
		<TradeItem subtype="heal_2" number ="30" />
	</Trade>
	
	<Topic name="trade" start_option="Potions" />
	
	<Topic name="start_dialogue" >
		<Effect>
			local pl = getSpeaker("main_player");
			set(pl,"health",get(pl,"max_health"));
		</Effect>
	</Topic>
</NPC>

<NPC refname="Sybill">
	<Trade refresh_time="600000" price_factor="1.5">
		<TradeItem subtype="bronze_sw"  number="1" number_magical="0"/>
		<TradeItem subtype="sabre_sw"  number="1" number_magical="0"/>
		<TradeItem subtype="legion_sw"  number="1" number_magical="0"/>
		<TradeItem subtype="steel2h_sw"  number="1" number_magical="0"/>
		<TradeItem subtype="smash_sw"  number="1" number_magical="0"/>
		<TradeItem subtype="horse_sw"  number="1" number_magical="0"/>
		<TradeItem subtype="cleave_axe"  number="1" number_magical="0"/>
		<TradeItem subtype="iron_axe"  number="1" number_magical="0"/>
		<TradeItem subtype="riping_axe"  number="1" number_magical="0"/>
		<TradeItem subtype="execut_axe"  number="1" number_magical="0"/>
		<TradeItem subtype="iron_hmr"  number="1" number_magical="0"/>
		<TradeItem subtype="maul_hmr"  number="1" number_magical="0"/>
		<TradeItem subtype="guard_hmr"  number="1" number_magical="0"/>
		<TradeItem subtype="silver_hmr"  number="1" number_magical="0"/>
		<TradeItem subtype="short_sbw"  number="1" number_magical="0"/>
		<TradeItem subtype="hunter_sbw"  number="1" number_magical="0"/>
		<TradeItem subtype="rattan_sbw"  number="1" number_magical="0"/>
		<TradeItem subtype="yew_lbw"  number="1" number_magical="0"/>
		<TradeItem subtype="long_lbw"  number="1" number_magical="0"/>
		<TradeItem subtype="soldr_lbw"  number="1" number_magical="0"/>
		<TradeItem subtype="novice_wnd_fire"  number="1" number_magical="0"/>
		<TradeItem subtype="alder_wnd_fire"  number="1" number_magical="0"/>
		<TradeItem subtype="novice_wnd_air"  number="1" number_magical="0"/>
		<TradeItem subtype="alder_wnd_air"  number="1" number_magical="0"/>
		<TradeItem subtype="novice_wnd_ice"  number="1" number_magical="0"/>
		<TradeItem subtype="alder_wnd_ice"  number="1" number_magical="0"/>
		<TradeItem subtype="rock_wnd"  number="1" number_magical="0"/>
		<TradeItem subtype="rock_stf"  number="1" number_magical="0"/>
		<TradeItem subtype="alder_stf_fire"  number="1" number_magical="0"/>
		<TradeItem subtype="alder_stf_air"  number="1" number_magical="0"/>
		<TradeItem subtype="alder_stf_ice"  number="1" number_magical="0"/>
	</Trade>
	
	<Topic name="trade" start_option="Weapons" />
</NPC>

<NPC refname="Halgor">
	<Trade refresh_time="600000" price_factor="1.5">
		<TradeItem subtype="rivet_arm"  number="1" number_magical="0"/>
		<TradeItem subtype="novice_arm"  number="1" number_magical="0"/>
		<TradeItem subtype="merc_arm"  number="1" number_magical="0"/>
		<TradeItem subtype="bandit_arm"  number="1" number_magical="0"/>
		<TradeItem subtype="rngsh_arm"  number="1" number_magical="0"/>
		<TradeItem subtype="leath_hlm"  number="1" number_magical="0"/>
		<TradeItem subtype="merchd_hlm"  number="1" number_magical="0"/>
		<TradeItem subtype="novice_hlm"  number="1" number_magical="0"/>
		<TradeItem subtype="merc_hlm"  number="1" number_magical="0"/>
		<TradeItem subtype="rngbnd_hlm"  number="1" number_magical="0"/>
		<TradeItem subtype="novice_rob"  number="1" number_magical="0"/>
		<TradeItem subtype="alch_rob"  number="1" number_magical="0"/>
		<TradeItem subtype="sholar_rob"  number="1" number_magical="0"/>
		<TradeItem subtype="snake_glv"  number="1" number_magical="0"/>
		<TradeItem subtype="chain_glv"  number="1" number_magical="0"/>
		<TradeItem subtype="bucskn_glv"  number="1" number_magical="0"/>
		<TradeItem subtype="wood_shd"  number="1" number_magical="0"/>
		<TradeItem subtype="bronze_shd"  number="1" number_magical="0"/>
		<TradeItem subtype="iron_shd"  number="1" number_magical="0"/>
		<TradeItem subtype="novice_hat"  number="1" number_magical="0"/>
		<TradeItem subtype="alch_hat"  number="1" number_magical="0"/>
		<TradeItem subtype="beret_hat"  number="1" number_magical="0"/>
	</Trade>	
	<Topic name="trade" start_option="Armors" />
</NPC>

<NPC refname="Marco">
		
	<Trade refresh_time="600000" price_factor="10">
		<TradeItem subtype="sabre_sw"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.6"/>
		<TradeItem subtype="legion_sw"  number="0" number_magical="1" min_enchant="100" max_enchant="360" probability="0.5"/>
		<TradeItem subtype="smash_sw"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.5"/>
		<TradeItem subtype="horse_sw"  number="0" number_magical="1" min_enchant="100" max_enchant="360" probability="0.5"/>
		
		<TradeItem subtype="iroclb_hmr"  number="0" number_magical="1" min_enchant="100" max_enchant="300" probability="0.5"/>
		<TradeItem subtype="maul_hmr"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.6"/>
		<TradeItem subtype="mrnstr_hmr"  number="0" number_magical="1" min_enchant="100" max_enchant="360" probability="0.5"/>
		<TradeItem subtype="guard_hmr"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.6"/>
		<TradeItem subtype="silver_hmr"  number="0" number_magical="1" min_enchant="100" max_enchant="360" probability="0.5"/>
		
		<TradeItem subtype="cleave_axe"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.6"/>
		<TradeItem subtype="iron_axe"  number="0" number_magical="1" min_enchant="100" max_enchant="360" probability="0.5"/>
		<TradeItem subtype="execut_axe"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.6"/>
		
		<TradeItem subtype="long_lbw"  number="0" number_magical="3" min_enchant="100" max_enchant="300" probability="0.6"/>
		<TradeItem subtype="hunter_sbw"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.6"/>
		<TradeItem subtype="hunter_sbw"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.6"/>
		
		<TradeItem subtype="rock_stf"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.6"/>
		<TradeItem subtype="rock_wnd"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.6"/>
		<TradeItem subtype="alder_wnd_fire"  number="0" number_magical="1" min_enchant="100" max_enchant="360" probability="0.3"/>
		<TradeItem subtype="alder_wnd_air"  number="0" number_magical="1" min_enchant="100" max_enchant="360" probability="0.3"/>
		<TradeItem subtype="alder_wnd_ice"  number="0" number_magical="1" min_enchant="100" max_enchant="360" probability="0.3"/>
		<TradeItem subtype="alder_stf_fire"  number="0" number_magical="1" min_enchant="100" max_enchant="360" probability="0.3"/>
		<TradeItem subtype="alder_stf_air"  number="0" number_magical="1" min_enchant="100" max_enchant="360" probability="0.3"/>
		<TradeItem subtype="alder_stf_ice"  number="0" number_magical="1" min_enchant="100" max_enchant="360" probability="0.3"/>
		
		<TradeItem subtype="bandit_arm"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.6"/>
		<TradeItem subtype="merc_arm"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.6"/>
		<TradeItem subtype="rngsh_arm"  number="0" number_magical="1" min_enchant="100" max_enchant="300" probability="0.5"/>
		<TradeItem subtype="novice_arm"  number="0" number_magical="1" min_enchant="100" max_enchant="360" probability="0.5"/>
		<TradeItem subtype="alch_rob"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.6"/>
		<TradeItem subtype="sholar_rob"  number="0" number_magical="1" min_enchant="100" max_enchant="360" probability="0.5"/>
		
		<TradeItem subtype="chain_glv"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.5"/>
		<TradeItem subtype="snake_glv"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.5"/>
		<TradeItem subtype="bucskn_glv"  number="0" number_magical="1" min_enchant="100" max_enchant="360" probability="0.5"/>
		
		<TradeItem subtype="alch_hat"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.5"/>
		<TradeItem subtype="beret_hat"  number="0" number_magical="1" min_enchant="100" max_enchant="300" probability="0.4"/>
		<TradeItem subtype="merchd_hlm"  number="0" number_magical="1" min_enchant="100" max_enchant="300" probability="0.6"/>
		<TradeItem subtype="novice_hlm"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.5"/>
		<TradeItem subtype="merchd_hlm"  number="0" number_magical="1" min_enchant="100" max_enchant="360" probability="0.5"/>
		
		<TradeItem subtype="bronze_shd"  number="0" number_magical="2" min_enchant="100" max_enchant="300" probability="0.6"/>
		<TradeItem subtype="iron_shd"  number="0" number_magical="1" min_enchant="100" max_enchant="300" probability="0.4"/>
		
		<TradeItem subtype="amber_rng"  number="0" number_magical="5" min_enchant="100" max_enchant="250" probability="0.6"/>
		<TradeItem subtype="silver_rng"  number="0" number_magical="8" min_enchant="100" max_enchant="300" probability="0.6"/>
		<TradeItem subtype="jet_rng"  number="0" number_magical="3" min_enchant="100" max_enchant="300" probability="0.5"/>
		<TradeItem subtype="amber_aml"  number="0" number_magical="7" min_enchant="100" max_enchant="250" probability="0.6"/>
		<TradeItem subtype="silver_aml"  number="0" number_magical="7" min_enchant="100" max_enchant="300" probability="0.6"/>
	</Trade>	
	
	<Topic name="trade" start_option="Objects found" />
	
	<Topic name="the_goods" start_option="What are these Items?">
		<Condition>
			return(joringsbridge.talkedToMarco ~= true);
		</Condition>
		<Effect>
			speak("Marco",_("Ah, you noticed my lost and found?"),"amused");
			speak("Marco",_("Everything I find in and around Joringsbridge is stored here."));
			speak("Marco",_("If something is your's just say the word. For a small finder's fee you can have it back."))
			joringsbridge.talkedToMarco = true;
		</Effect>
	</Topic>
</NPC>

<NPC refname="Sergeant Lutterer">
	<Topic name="Joringsbridge_sergeant" start_option="Joringsbridge">
		<Effect>
			addSpeaker(joringsbridge.sergeant,"sergeant");
			speak("sergeant",_("Having the responsibility for Joringsbridge is never easy, not even when I had enough soldiers."),"thoughtful");
			speak("sergeant",_("Lately, someone in the guard has been appropriating confiscated magical items."),"sad");
			speak("sergeant",_("And I'm not even one step closer to find out who, than when I first noticed!"),"angry");
			speak("player",_("((A guard is diverting items? Surely not for hard times. I should take a look around.))"))
		</Effect>
	</Topic>
	
	<Topic name="surroundings_sergeant" start_option="The surroundings of Joringsbridge">
		<Effect>
			addSpeaker(joringsbridge.sergeant,"sergeant");
			speak("sergeant",_("You better be careful when leaving the village."),"thoughtful");
			speak("sergeant",_("Now, with almost all troops standing at the borders, we have to deal with an unmanageable flood of goblins."),"normal");
			speak("sergeant",_("And everyone not drafted for the army seems to have discovered the happy bandit life for themselves."),"angry");
			speak("player",_("Thanks for the warning, sergeant."),"amused");
		</Effect>
	</Topic>
</NPC>

<NPC refname="Michel Bron">
</NPC>

<NPC refname="Magus Convocatis Relau Fireweaver">
	<Topic name="Joringsbridge_mage" start_option="Joringsbridge">
		<Effect>
			addSpeaker(joringsbridge.council,"council");
			speak("council",_("You are the backup sent by Lord Master Windclaw, arn't you?"),"sneer");
			speak("council",_("I suggest you quickly journey on. There have been people dying by boredom in this village. "),"bored");
			speak("council",_("Who knows if your physique will help you against that, too?"),"grin");
		</Effect>
	</Topic>
	
	<Topic name="start_dialogue" >
		<Effect>
			if(tutorial.smith ~=true)then
				changeTopic("smith_intro")
			end
		</Effect>
	</Topic>
	
	<Topic name="smith_intro" >
		<Effect>
			tutorial.smith = true
			addSpeaker(joringsbridge.council,"council")
			speak("council",_("Welcome to the humble... village, they call it... of Joringsbridge."),"aloof")
			speak("council",_("I have been stationed here due to the unfathomable wisdom of the Council."),"unhappy")
			speak("council",_("If you want, I can add a certain something to your weapons."),"normal")
			speak("council",_("I am also quite adept at imbuing clothes with extra protection against the elements."))
			speak("council",_("Nothing more to do anyway."))
		</Effect>
	</Topic>
	
	<Topic name="no_ice" start_option="Why can't you use ice?">
		<Effect>
			addSpeaker(joringsbridge.council,"council")
			speak("council",_("Of course I know how to conjure ice..."),"aloof")
			speak("council",_("but, as you are no doubt unaware, casting and enchanting are two utterly different activities."),"aloof")
			speak("council",_("Be grateful I am able to enchant two elements."),"aloof")
			speak("council",_("That's a rare talent, just so you know. "),"aloof")
		</Effect>
	</Topic>
	
	<Topic name="enchant_start" start_option="Enchant Equipment" >
		<Effect>
			-- chose a unique variable name here
			mods_joringsbridge = {};
			
			-- List of all possible mods:
			-- max_health armor block strength dexterity willpower magic_power
			-- resist_phys resist_fire resist_ice resist_air resist_all
			-- phys_dmg fire_dmg ice_dmg air_dmg phys_mult fire_mult ice_mult air_mult attack_speed attack power

			-- options for Armor enchanting
			-- dont forget the _() markers for strings that are displayed ingame
			mods_joringsbridge[1] = {};
			mods_joringsbridge[1].answer_str = _("Armor")	-- string displayed in selection menu
			mods_joringsbridge[1].itempos = "armor"		-- position of the item
			mods_joringsbridge[1].allowed_mods = {"resist_fire", "resist_air"}
			mods_joringsbridge[1].mod_answers = {_("Fire resistance"), _("Air resistance")}
			
			mods_joringsbridge[2] = {};
			mods_joringsbridge[2].answer_str = _("Weapon")	-- string displayed in selection menu
			mods_joringsbridge[2].itempos = "weapon"		-- position of the item
			mods_joringsbridge[2].allowed_mods = {"fire_dmg", "air_dmg", "fire_mult"}
			mods_joringsbridge[2].mod_answers = {_("Fire damage"), _("Air damage"), _("Increase Firemagic")}
			
			-- create item Selection
			addQuestion(_("Which part of your equipment should be enchanted?"))
			local nr, mod
			for nr,mod in pairs(mods_joringsbridge) do
				addAnswer(mod.answer_str,"select_mod");
			end;
		</Effect>
		
	</Topic>
	
	
	<Topic name="select_mod">
		<Effect>
			enchanter_mod = mods_joringsbridge[trigger.answer_id];
			
			-- select the item as current item
			local pl = getSpeaker("main_player");
			getPlayerItem(pl,enchanter_mod.itempos);
			if (not hasCurrentItem()) then
				speak("Magus Convocatis Relau Fireweaver",_("It may be helpful if you would equip something first."),"sneer")
			else
				-- create modifier selection
				addQuestion(_("Which Enchantment do you want?"))
				local nr, answer
				for nr,answer in pairs(enchanter_mod.mod_answers) do
					addAnswer(answer,"check_price");
				end;
			end;
		</Effect>
	</Topic>
	
	<Topic name="check_price">
		<Effect>
			-- chose another unique variable here
			enchanter_modtype_joringsbridge = trigger.answer_id;
			
			local pl = getSpeaker("main_player");
			local pgold = get(pl,"gold");
			
			local magic = getItemValue("magic_power");
			print(magic)
			print(math.exp( magic / 100 - 1))
			enchanter_price_joringsbridge = math.ceil(500 + magic*15 + 150*math.exp( magic / 80 - 1))
			print(enchanter_price_joringsbridge)
			
			if (enchanter_price_joringsbridge > pgold) then
				speak("Magus Convocatis Relau Fireweaver",_("I may work for the Council, but I don't run a charity. The price is $1.",{enchanter_price_joringsbridge}))
			else
				addQuestion(_("The price is $1",{enchanter_price_joringsbridge}))
				addAnswer("OK","do_enchant");
				addAnswer("Better not.","end")
			end
		</Effect>
	</Topic>
	
	<Topic name="do_enchant">
		<Effect>
			local pl = getSpeaker("main_player");
			local pgold = get(pl,"gold");
			set(pl,"gold",pgold - enchanter_price_joringsbridge);
			
			-- enchant strength is set here
			local mods = addItemMagicMods(enchanter_mod.allowed_mods[enchanter_modtype_joringsbridge] ,120);
			if (mods == nil) then
				mods = 0;
			end;
			if (mods == 0) then
				speak("Magus Convocatis Relau Fireweaver",_("As I always say: No enchantment should be applied a second time."),"unhappy");
				set(pl,"gold",pgold);
			else
				--set enchant animation
				setObjectAnimation(joringsbridge.council, "enchant", 1500)
				-- removing the item from inventory and reinserting
				-- ensures, that the item is unequiped if level requirement is not met
				removePlayerItem(pl,enchanter_mod.itempos);
				insertPlayerItem(pl,true);
			end;
		</Effect>
	</Topic>

	
	</NPC>
